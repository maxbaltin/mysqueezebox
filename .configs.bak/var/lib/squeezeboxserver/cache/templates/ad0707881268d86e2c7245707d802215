#------------------------------------------------------------------------
# Compiled template generated by the Template Toolkit version 2.21
#------------------------------------------------------------------------

Template::Document->new({
    METADATA => {
        'name' => 'tracks.template',
        'modtime' => '1317700020',
    },
    BLOCK => sub {
        my $context = shift || die "template sub called without context\n";
        my $stash   = $context->stash;
        my $output  = '';
        my $_tt_error;
        
        eval { BLOCK: {
    $output .=  "<?xml version=\"1.0\" encoding=\"utf-8\"?>\n<databasequery>\n	<dataquery>\n		<name>";
#line 4 "/var/lib/squeezeboxserver/cache/InstalledPlugins/Plugins/DatabaseQuery/Templates/tracks.template"
    $output .=  $stash->get('queryname');
    $output .=  "</name>\n		<queryid>track</queryid>\n		<query>\n			select tracks.id,tracks.disc,tracks.tracknum,tracks.title";
#line 7 "/var/lib/squeezeboxserver/cache/InstalledPlugins/Plugins/DatabaseQuery/Templates/tracks.template"
    if ($stash->get('showalbum')) {
    $output .=  ",albums.id as album_id,albums.title as album";
    }
    
#line 7 "/var/lib/squeezeboxserver/cache/InstalledPlugins/Plugins/DatabaseQuery/Templates/tracks.template"
    if ($stash->get('showtracksort')) {
    $output .=  ",tracks.titlesort";
    }
    
#line 7 "/var/lib/squeezeboxserver/cache/InstalledPlugins/Plugins/DatabaseQuery/Templates/tracks.template"
    if ($stash->get('showmusicbrainz')) {
    $output .=  ",tracks.musicbrainz_id";
    }
    
#line 7 "/var/lib/squeezeboxserver/cache/InstalledPlugins/Plugins/DatabaseQuery/Templates/tracks.template"
    if ($stash->get('showbitrate')) {
    $output .=  ",concat(round(tracks.bitrate/1000),' kbit/s') as bitrate";
    }
    
#line 7 "/var/lib/squeezeboxserver/cache/InstalledPlugins/Plugins/DatabaseQuery/Templates/tracks.template"
    if ($stash->get('showartist')) {
    $output .=  ",group_concat(distinct contributors.name";
#line 7 "/var/lib/squeezeboxserver/cache/InstalledPlugins/Plugins/DatabaseQuery/Templates/tracks.template"
    if ($stash->get('MySQL')) {
    $output .=  " order by contributors.namesort";
    }
    
    $output .=  ") as artists";
    }
    
    $output .=  " from tracks\n				join albums on\n					albums.id=tracks.album\n				";
#line 16 "/var/lib/squeezeboxserver/cache/InstalledPlugins/Plugins/DatabaseQuery/Templates/tracks.template"
    if ($stash->get('showartist')) {
    $output .=  "\n				left join contributor_track on\n					contributor_track.track=tracks.id \n					";
#line 13 "/var/lib/squeezeboxserver/cache/InstalledPlugins/Plugins/DatabaseQuery/Templates/tracks.template"
    if ($stash->get('roles')) {
    $output .=  "and contributor_track.role in (";
#line 13 "/var/lib/squeezeboxserver/cache/InstalledPlugins/Plugins/DatabaseQuery/Templates/tracks.template"
    $output .=  $stash->get('roles');
    $output .=  ")";
    }
    
    $output .=  "\n				left join contributors on\n					contributor_track.contributor=contributors.id\n				";
    }
    
    $output .=  "\n			where\n				tracks.id is not null\n				";
#line 21 "/var/lib/squeezeboxserver/cache/InstalledPlugins/Plugins/DatabaseQuery/Templates/tracks.template"
    if ($stash->get('withmusicbrainz')) {
    $output .=  "\n				and tracks.musicbrainz_id is not null\n				";
    }
    
    $output .=  "\n				";
#line 24 "/var/lib/squeezeboxserver/cache/InstalledPlugins/Plugins/DatabaseQuery/Templates/tracks.template"
    if ($stash->get('withmusicbrainz')) {
    $output .=  "\n				and tracks.musicbrainz_id is null\n				";
    }
    
    $output .=  "\n				";
#line 27 "/var/lib/squeezeboxserver/cache/InstalledPlugins/Plugins/DatabaseQuery/Templates/tracks.template"
    if ($stash->get('withcompilation')) {
    $output .=  "\n				and albums.compilation is not null \n				";
    }
    
    $output .=  "\n				";
#line 30 "/var/lib/squeezeboxserver/cache/InstalledPlugins/Plugins/DatabaseQuery/Templates/tracks.template"
    if ($stash->get('withoutcompilation')) {
    $output .=  "\n				and albums.compilation is null \n				";
    }
    
    $output .=  "\n				";
#line 37 "/var/lib/squeezeboxserver/cache/InstalledPlugins/Plugins/DatabaseQuery/Templates/tracks.template"
    if ($stash->get('includedartists')) {
    $output .=  "\n				and exists (select * from contributors,contributor_track where\n							contributors.id=contributor_track.contributor and\n							contributor_track.track=tracks.id and\n							contributors.name in (";
#line 35 "/var/lib/squeezeboxserver/cache/InstalledPlugins/Plugins/DatabaseQuery/Templates/tracks.template"
    $output .=  $stash->get('includedartists');
    $output .=  ")\n							";
#line 36 "/var/lib/squeezeboxserver/cache/InstalledPlugins/Plugins/DatabaseQuery/Templates/tracks.template"
    if ($stash->get('roles')) {
    $output .=  "and contributor_track.role in (";
#line 36 "/var/lib/squeezeboxserver/cache/InstalledPlugins/Plugins/DatabaseQuery/Templates/tracks.template"
    $output .=  $stash->get('roles');
    $output .=  ")";
    }
    
    $output .=  ")\n				";
    }
    
    $output .=  "\n				";
#line 43 "/var/lib/squeezeboxserver/cache/InstalledPlugins/Plugins/DatabaseQuery/Templates/tracks.template"
    if ($stash->get('includedgenres')) {
    $output .=  "\n				and exists (select * from genres,genre_track where\n							genres.id=genre_track.genre and\n							genre_track.track=tracks.id and\n							genres.name in (";
#line 42 "/var/lib/squeezeboxserver/cache/InstalledPlugins/Plugins/DatabaseQuery/Templates/tracks.template"
    $output .=  $stash->get('includedgenres');
    $output .=  "))\n				";
    }
    
    $output .=  "\n			group by tracks.id\n			order by albums.titlesort,albums.id,tracks.disc,tracks.tracknum,tracks.titlesort\n		</query>\n	</dataquery>\n</databasequery>\n\n";
        } };
        if ($@) {
            $_tt_error = $context->catch($@, \$output);
            die $_tt_error unless $_tt_error->type eq 'return';
        }
    
        return $output;
    },
    DEFBLOCKS => {

    },
});
